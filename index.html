
<!DOCTYPE html>
<html>
<head>
  <title>æœºå™¨äººå®éªŒå®¤ - ä¸‰æ –ä¸–ç•Œ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #e0f7ff;
      font-family: 'Arial', sans-serif;
    }
    #game {
      position: relative;
      width: 400px;
      height: 600px;
      border: 4px solid #333;
      border-radius: 8px;
      overflow: hidden;
      background: linear-gradient(to bottom, #b3e5fc, #a0d8ef); /* å¤©è“è‰²å¤©ç©º */
    }
    canvas {
      display: block;
    }
    .menu {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      z-index: 10;
    }
    button {
      padding: 12px 30px;
      font-size: 18px;
      background: #4CAF50;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 15px;
      font: bold 20px sans-serif;
      color: #006400;
      text-shadow: 1px 1px 1px white;
      z-index: 5;
    }
  </style>
</head>
<body>

<div id="game">
  <canvas id="canvas" width="400" height="600"></canvas>
  <div id="score">å¾—åˆ†: 0</div>

  <!-- å¼€å§‹ç•Œé¢ -->
  <div id="start" class="menu">
    <h2 style="color:#4CAF50;">ğŸš€ å¯åŠ¨é£è¡Œå™¨</h2>
    <p>ç©¿è¶Š10é“é—¨<br>æŠµè¾¾æœªæ¥ä¸–ç•Œ</p>
    <button id="btn-start">å¼€å§‹é£è¡Œ</button>
  </div>

  <!-- ç»“æŸç•Œé¢ -->
  <div id="over" class="menu" style="display:none;">
    <h2>âš ï¸ ç³»ç»Ÿä¼‘çœ </h2>
    <p>å…±ç©¿è¶Š <span id="final">0</span> åŒºåŸŸ</p>
    <button id="btn-restart">é‡æ–°æ¿€æ´»</button>
  </div>
</div>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const startScreen = document.getElementById('start');
  const gameOverScreen = document.getElementById('over');
  const scoreDisplay = document.getElementById('score');
  const finalScore = document.getElementById('final');
  const btnStart = document.getElementById('btn-start');
  const btnRestart = document.getElementById('btn-restart');

  // æ¸¸æˆå˜é‡
  let bot, pipes, isPressed, isRunning, score, gameMode;
  let gameLoopId = null;
  let pipeIntervalId = null;

  // å®éªŒå®¤ä¸­çš„æœºå™¨äººï¼ˆä¸‰æ –ï¼‰
  let flyingBots = [];
  let groundBots = [];
  let seaBots = [];

  // æ¨¡å¼å®šä¹‰
  const MODE_NORMAL = 'normal';
  const MODE_LAB = 'lab'; // è¿›å…¥å®éªŒå®¤

  // åˆå§‹åŒ–æ¸¸æˆ
  function init() {
    if (gameLoopId) cancelAnimationFrame(gameLoopId);
    if (pipeIntervalId) clearInterval(pipeIntervalId);

    bot = { x: 80, y: 300, w: 50, h: 30 };
    pipes = [];
    isPressed = false;
    isRunning = true;
    score = 0;
    gameMode = MODE_NORMAL;

    // æ¸…ç©ºä¸‰æ –æœºå™¨äºº
    flyingBots = [];
    groundBots = [];
    seaBots = [];

    scoreDisplay.textContent = `å¾—åˆ†: ${score}`;

    // æ­£å¸¸æ¨¡å¼ç”Ÿæˆç®¡é“
    pipeIntervalId = setInterval(() => {
      if (!isRunning || gameMode !== MODE_NORMAL) return;
      const gap = 180;
      const minHeight = 80;
      const maxHeight = 500 - gap - minHeight;
      const topHeight = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;

      pipes.push({
        x: 400,
        w: 60,
        topH: topHeight,
        botY: topHeight + gap,
        passed: false
      });
    }, 2500);
  }

  // ç»˜åˆ¶ä¸»è§’é£è¡Œæœºå™¨äºº
  function drawBot(x, y, angleRad) {
    ctx.save();
    ctx.translate(x + 25, y + 15);
    ctx.rotate(angleRad);

    ctx.fillStyle = '#A0D8F1';
    ctx.beginPath(); ctx.ellipse(0, 0, 25, 12, 0, 0, Math.PI * 2); ctx.fill();

    ctx.fillStyle = '#D0F0FF';
    ctx.beginPath(); ctx.ellipse(0, -2, 18, 6, 0, 0, Math.PI * 2); ctx.fill();

    ctx.fillStyle = '#FFFFFF'; ctx.beginPath(); ctx.arc(0, 0, 5, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = '#00D1FF'; ctx.beginPath(); ctx.arc(0, 0, 2, 0, Math.PI * 2); ctx.fill();

    // æ¨è¿›ç«ç„°
    if (!isPressed) {
      for (let i = 0; i < 3; i++) {
        const fy = -3 + i * 3;
        const fw = 2 + Math.random() * 1.5;
        ctx.fillStyle = ['#8AF', '#68F', '#AAFFFF'][i];
        ctx.fillRect(-26 - fw, fy, fw, 2);
        ctx.fillRect(20, fy, fw, 2);
      }
    }

    // å¤©çº¿
    ctx.strokeStyle = '#CCC'; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(0, -12); ctx.lineTo(0, -20); ctx.stroke();
    ctx.fillStyle = '#FF5555'; ctx.beginPath(); ctx.arc(0, -22, 3, 0, Math.PI * 2); ctx.fill();

    ctx.restore();
  }

  // ç»˜åˆ¶ä¸‰æ –èƒŒæ™¯
  function drawLabScene() {
    // === å¤©ç©º ===
    ctx.fillStyle = '#b3e5fc';
    ctx.fillRect(0, 0, 400, 200);

    // === äº‘æœµè£…é¥° ===
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    [[100,50],[250,80]].forEach(([x,y])=>{
      ctx.beginPath(); ctx.arc(x-15,y,15,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(x,y-10,20,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(x+15,y,15,0,Math.PI*2); ctx.fill();
    });

    // === é™†åœ°ï¼ˆåœ°é¢ï¼‰===
    ctx.fillStyle = '#9ECB7C';
    ctx.fillRect(0, 400, 400, 80);

    // === æµ·æ´‹ï¼ˆæ°´ä½“ï¼‰===
    ctx.fillStyle = '#4A90E2';
    ctx.fillRect(0, 480, 400, 120);

    // æ°´æ³¢çº¹
    ctx.strokeStyle = '#6EB5FF';
    ctx.lineWidth = 1;
    for (let i = 0; i < 400; i += 20) {
      ctx.beginPath();
      ctx.moveTo(i, 490);
      ctx.quadraticCurveTo(i + 10, 488, i + 20, 490);
      ctx.stroke();
    }

    // æ ‡é¢˜æ–‡å­—
    ctx.fillStyle = '#006400';
    ctx.font = 'bold 32px Arial';
    ctx.textAlign = 'center';
    ctx.fillText("æ¬¢è¿æ¥åˆ°", 200, 250);
    ctx.fillStyle = '#003366';
    ctx.font = 'bold 36px "Comic Sans MS"';
    ctx.fillText("æœºå™¨äººå®éªŒå®¤", 200, 300);
    ctx.fillStyle = '#555';
    ctx.font = '16px sans-serif';
    ctx.fillText("â€”â€” å…¨åœºæ™¯å¼€å‘ä¸­", 200, 330);
  }

  // åˆ›å»ºä¸‰æ –æœºå™¨äºº
  function createLabRobots() {
    // é£è¡Œæœºå™¨äººï¼ˆå¤©ä¸Šï¼‰
    flyingBots = [
      { x: 80, y: 100, dx: 1, type: 'fly' },
      { x: 300, y: 140, dx: -1, type: 'fly' }
    ];

    // åœ°é¢æœºå™¨äººï¼ˆåœ°ä¸Šè¡Œèµ°ï¼‰
    groundBots = [
      { x: 100, y: 450, dx: 1, type: 'walk' },
      { x: 300, y: 450, dx: -1, type: 'walk' }
    ];

    // æµ·åº•æœºå™¨äººï¼ˆæµ·é‡Œæ¸¸åŠ¨ï¼‰
    seaBots = [
      { x: 60, y: 530, dx: 1.2, type: 'swim' },
      { x: 340, y: 550, dx: -1.0, type: 'swim' }
    ];
  }

  // ç»˜åˆ¶å¹¶æ›´æ–°ä¸‰æ –æœºå™¨äºº
  function updateAndDrawRobots() {
    if (flyingBots.length === 0) createLabRobots();

    // æ›´æ–°å’Œç»˜åˆ¶é£è¡Œæœºå™¨äººï¼ˆç©ºä¸­æ»‘ç¿”ï¼‰
    flyingBots.forEach(r => {
      r.x += r.dx;
      if (r.x > 420) r.x = -40;
      if (r.x < -40) r.x = 420;

      ctx.save();
      ctx.translate(r.x, r.y);
      ctx.scale(r.dx > 0 ? 1 : -1, 1); // é¢å‘ç§»åŠ¨æ–¹å‘

      // é£è¡Œå™¨é€ å‹
      ctx.fillStyle = '#A0D8F1';
      ctx.fillRect(-12, -10, 24, 12);
      ctx.fillStyle = '#8AC6FF';
      ctx.beginPath(); ctx.arc(0, -10, 8, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = '#00D1FF';
      ctx.beginPath(); ctx.arc(0, -10, 3, 0, Math.PI * 2); ctx.fill();

      // å°ç¿…è†€
      ctx.fillStyle = '#666';
      ctx.fillRect(-20, -6, 6, 10);
      ctx.fillRect(14, -6, 6, 10);

      ctx.restore();
    });

    // æ›´æ–°å’Œç»˜åˆ¶åœ°é¢æœºå™¨äººï¼ˆè¡Œèµ°ï¼‰
    groundBots.forEach(r => {
      r.x += r.dx;
      if (r.x > 380 || r.x < 20) r.dx *= -1;

      ctx.save();
      ctx.translate(r.x, r.y);

      // èº«ä½“
      ctx.fillStyle = '#A0D8F1';
      ctx.fillRect(-10, -20, 20, 20);
      ctx.fillStyle = '#8AC6FF';
      ctx.beginPath(); ctx.arc(0, -28, 8, 0, Math.PI * 2); ctx.fill();

      // ç”µå­çœ¼
      ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(-3, -28, 3, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(-3, -28, 1.5, 0, Math.PI * 2); ctx.fill();

      // æ‰‹è‡‚æ‘†åŠ¨
      ctx.fillRect(-18, -18, 4, 10);
      ctx.fillRect(14, -18, 4, 10);

      // è…¿éƒ¨äº¤æ›¿
      ctx.fillRect(-10, -2, 6, 10);
      ctx.fillRect(4, -2, 6, 10);

      ctx.restore();
    });

    // æ›´æ–°å’Œç»˜åˆ¶æµ·åº•æœºå™¨äººï¼ˆå·¦å³æ¸¸åŠ¨ï¼‰
    seaBots.forEach(r => {
      r.x += r.dx;
      if (r.x > 420) r.x = -40;
      if (r.x < -40) r.x = 420;

      ctx.save();
      ctx.translate(r.x, r.y);
      ctx.scale(r.dx > 0 ? 1 : -1, 1);

      // æ½œèˆªæœºå™¨äººï¼ˆé±¼é›·å½¢ï¼‰
      ctx.fillStyle = '#4A90E2';
      ctx.beginPath(); ctx.ellipse(0, 0, 18, 10, 0, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = '#6EB5FF';
      ctx.beginPath(); ctx.arc(0, 0, 4, 0, Math.PI * 2); ctx.fill();

      // é³ç‰‡
      ctx.fillStyle = '#3A7BC8';
      ctx.fillRect(-10, -6, 4, 12);
      ctx.fillRect(6, -4, 4, 8);

      ctx.restore();
    });
  }

  // ç»˜åˆ¶æ™®é€šåœºæ™¯
  function drawNormalScene() {
    // ç™½äº‘
    ctx.fillStyle = 'rgba(255,255,255,0.6)';
    [[80,100],[280,160]].forEach(([cx,cy])=>{
      ctx.beginPath(); ctx.arc(cx-20,cy,25,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(cx,cy-10,35,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(cx+20,cy,25,0,Math.PI*2); ctx.fill();
    });

    // ç»¿å¢™
    ctx.fillStyle = '#4CAF50';
    pipes.forEach(p => {
      ctx.fillRect(p.x, 0, p.w, p.topH);
      ctx.fillRect(p.x, p.botY, p.w, 600 - p.botY);
      ctx.fillStyle = '#3e8b41';
      ctx.fillRect(p.x, p.topH - 8, p.w, 4);
      ctx.fillRect(p.x, p.botY, p.w, 4);
      ctx.fillStyle = '#4CAF50';
    });
  }

  // ç»˜åˆ¶ç”»é¢
  function draw() {
    ctx.clearRect(0, 0, 400, 600);

    if (gameMode === MODE_LAB) {
      drawLabScene();
      updateAndDrawRobots();
    } else {
      drawNormalScene();
      const angle = isPressed ? 0.3 : -0.15;
      drawBot(bot.x, bot.y, angle);
    }
  }

  // æ›´æ–°é€»è¾‘
  function update() {
    if (!isRunning) return;

    if (gameMode === MODE_NORMAL) {
      // æ§åˆ¶é£è¡Œ
      if (!isPressed) {
        bot.y -= 1.2;
      } else {
        bot.y += 4;
      }

      // è¾¹ç•Œæ£€æµ‹
      if (bot.y <= 0 || bot.y >= 570) {
        gameOver();
        return;
      }

      // ç®¡é“ç§»åŠ¨ + å¾—åˆ†
      pipes.forEach(pipe => {
        pipe.x -= 2;

        if (!pipe.passed && pipe.x + pipe.w < bot.x) {
          score++;
          scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
          pipe.passed = true;

          // ğŸ‰ ç¬¬10å…³å¼€å¯å®éªŒå®¤
          if (score === 10) {
            enterRobotLab();
          }
        }

        // ç¢°æ’æ£€æµ‹
        if (
          bot.x + 50 > pipe.x &&
          bot.x < pipe.x + pipe.w &&
          (bot.y < pipe.topH || bot.y + 30 > pipe.botY)
        ) {
          gameOver();
        }
      });

      // åˆ é™¤æ—§ç®¡é“
      while (pipes.length > 0 && pipes[0].x < -60) {
        pipes.shift();
      }
    }

    draw();
    gameLoopId = requestAnimationFrame(update);
  }

  // è¿›å…¥æœºå™¨äººå®éªŒå®¤
  function enterRobotLab() {
    gameMode = MODE_LAB;
    alert("ğŸ‰ æ­å–œï¼\n\nä½ å·²æˆåŠŸæŠµè¾¾ï¼š\n\nã€æœºå™¨äººå®éªŒå®¤ã€‘\n\nç³»ç»Ÿå¼€å‘ä¸­â€¦â€¦");
    pipes = [];
    if (pipeIntervalId) clearInterval(pipeIntervalId);
  }

  function gameOver() {
    isRunning = false;
    finalScore.textContent = score;
    gameOverScreen.style.display = 'flex';
    if (pipeIntervalId) clearInterval(pipeIntervalId);
  }

  function startGame() {
    init();
    startScreen.style.display = 'none';
    gameOverScreen.style.display = 'none';
    update();
  }

  // äº‹ä»¶ç»‘å®š
  window.addEventListener('load', () => {
    btnStart.onclick = startGame;
    btnRestart.onclick = startGame;

    canvas.onmousedown = () => { isPressed = true; };
    window.onmouseup = () => { isPressed = false; };

    canvas.ontouchstart = e => { e.preventDefault(); isPressed = true; };
    window.ontouchend = () => { isPressed = false; };

    window.onkeydown = e => {
      if (e.code === 'Space') { e.preventDefault(); isPressed = true; }
    };
    window.onkeyup = e => {
      if (e.code === 'Space') { isPressed = false; }
    };
  });
</script>

</body>
</html>